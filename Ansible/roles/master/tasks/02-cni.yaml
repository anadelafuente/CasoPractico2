---

# Instalamos el plugin CNI (Container Network Interface) de kubernetes y definimos la red de los PODs 10.1.1.0/16:
- name: CNI
  command: "kubeadm init --pod-network-cidr 10.1.1.0/16"
  become: yes
  register: kubeadm
- debug: msg="{{kubeadm.stdout}}"

#Guardar variable en un fichero para despu√©s leerlo
- name: copy files
  copy:
    content: 'kubeadm.stdout'
    dest: "{{ kubeadm }}"
  become: yes
  with_items:
      - "kubeadm"

#autorizar al usuario root acceder al cluster
- name: Create a directory if it does not exist
  file:
    path: /root/.kube
    state: directory
    mode: '0644'

- name: Auth user cluster access
  command: "cp -i /etc/kubernetes/admin.conf /root/.kube/config"
  become: yes

- name: Auth user
  command: "chown $(id -u):$(id -g) /root/.kube/config"
  become: yes